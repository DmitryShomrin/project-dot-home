name: vaultwarden

services:
  vaultwarden:
    image: vaultwarden/server:{{ docker_compose_vaultwarden_image_version }}
    container_name: vaultwarden
    restart: unless-stopped
    environment:
      DOMAIN: "https://vaultwarden.{{ docker_compose_services_domain }}"
      SIGNUPS_ALLOWED: "true"
      ADMIN_TOKEN: {{ docker_compose_vaultwarden_admin_token }}
      DATABASE_URL: postgresql://{{ docker_compose_vaultwarden_database_user }}:{{ docker_compose_vaultwarden_database_password }}@{{ docker_compose_vaultwarden_database_host }}:5432/{{ docker_compose_vaultwarden_database_name }}
    user: {{ getent_passwd[ansible_user].1 }}:{{ getent_passwd[ansible_user].2 }}
    networks:
{% for item in docker_compose_networks %}
      - {{ item }}
{% endfor %}
    volumes:
      - {{ docker_compose_vaultwarden_data_dir }}:/data
{% if docker_compose_vaultwarden_labels %}
    labels:
{% endif %}
{% for item in docker_compose_vaultwarden_labels %}
      - {{ item }}
{% endfor %}

networks:
{% for item in docker_compose_networks %}
  {{ item }}:
    name: {{ item }}
    external: true
{% endfor %}
